# 正点原子开发板IMX6ULL uboot网络配置（校园网）

本博客主要用于记录在跟随正点原子教程移植uboot过程中对于网络的配置流程

## 设备

主机：Windows 10

虚拟机：VMWare ubuntu22.04

开发板：IMX6ULL（未移植Linux系统）



## 连接方式

主机通过校园网Wi-Fi连接外网，虚拟机与主机通过桥接网络连接，开发板与主机网线连接



## 实现结果

主机与虚拟机互相ping通，uboot界面可以ping通主机与虚拟机。



## 注意事项

1. uboot的网络架构不完善，因此在主机和虚拟机端可能无法ping通开发板，但不影响网络连接

2. 此连接方式网段是自身的局域网，开发板中ping不通外网，但不影响实际开发

3. 文中的“外网”并非指科学上网，仅指日常使用的互联网

4. ==叠甲：本人并非科班出身，没有系统学过计算机网络，理论可能存在错误，但配置是成功的==

	

## 操作流程

### 主机端

1. 在确保物理连接稳定以后，Windows+R输入`ncpa.cpl`打开网络连接面板。保证具有以下两个适配器：一个"Wi-Fi" (已连接到校园网) 和一个 "以太网" (已插入网线，但可能显示“未识别的网络”)

	![1](assets/1.png)

2. 设置共享

	+ 右键点击你的 **"Wi-Fi"** 适配器。

	+ 选择 “属性” ，并切换到“共享”选项卡。

	+ 勾选 “允许其他网络用户通过此计算机的Internet连接来连接” 

	+ 在下方的“家庭网络连接” 下拉菜单中，**选择 "以太网" 适配器** (这是连接到IMX6ULL的适配器)。

	+ 点击“确定”

		![image-20251027110349551](assets/2.png)

3. 确认结果

	设置完成以后，进入“以太网”属性配置界面，可以看到适配器的IP已经被Windows自动设置为`192.168.137.1`.此时主机是一个DHCP服务器

	![image-20251027110641422](assets/3.png)

### 虚拟机端

注意：虚拟机需要连接到由主机“以太网”端口创建的这个新网络 (`192.168.137.x`)，而不是连接到Wi-Fi。

1. 关闭虚拟机

2. 进入“编辑”界面下的“虚拟网络编辑器”，并点击“更改设置”

	![image-20251027151525345](assets/4.png)

	修改VMnet0，选择桥接模式，并选择以太网的端口。点击应用后确定。

	![image-20251027151627915](assets/5.png)

3. 打开VMWare的虚拟机设置，找到“网络适配器”设置

4. 将网络连接模式从 "NAT" (网络地址转换) 修改为 **“自定义” **，并连接至VMnet0。

	<img src="assets/6.png" alt="image-20251027151818227" style="zoom:80%;" />

5. 添加新网络适配器，并选择NAT模式

	![image-20251027152451176](assets/7.png)

**:star2:此处网络适配器1将与主机、开发板处于同一网段下，用于互联使用。网络适配器2与主机的WLAN适配器共享同一个IP，用于登录外网使用。**

6. 启动虚拟机，并利用`ifconfig`命令查看ip。

	![image-20251027153200860](assets/8.png)

​	此时用于登录外网的ip为`192.168.8.1`，用于和开发板互联的ip为`192.168.137.16`。在网络设置部分设置静态ip

![QQ_1761550546457](assets/9.png)

==注意：地址要设置为`192.168.137.x`，子网掩码一致，网关ip为主机以太网ip==

此时，虚拟机与主机的网络均设置完毕，可以互相ping通。

![image-20251027153812640](assets/10.png)

![image-20251027153845651](assets/11.png)

### IMX6ULL(uboot)端

1. 在终端输入`dhcp`自动获取ip（如果前面配置无误，这里是可以自动获取到ip的），我这里获得到的是`192.168.137.31`

2. 如果自动申请失败，则可以手动设置，但需要提前在虚拟机端确定拟使用的ip并没有被占用，且处在`192.168.137.x`网段内。

	```powershell
	setenv ipaddr 192.168.137.31       # 开发板的IP (确保这个IP没被VM占用)
	setenv netmask 255.255.255.0         # 子网掩码
	setenv gatewayip 192.168.137.1       # 网关 (主机ip)
	setenv serverip 192.168.137.16        # TFTP/NFS服务器 (虚拟机ip)
	saveenv                             # 保存环境变量
	```

3. 在uboot下ping主机和虚拟机成功

	![image-20251027154734794](assets/12.png)

## 常见问题与解决

如果ping不通，在确保物理端连接无误后，记得检查主机端与虚拟机端防火墙设置，以及第三方杀毒软件是否关闭。

### 虚拟机端

使用指令`sudo ufw disable`关闭防火墙

### 主机端

1. 在Windows搜索 "Windows Defender 防火墙"。

2. 点击 "高级设置"

3. 点击 "入站规则"

4. 找到名为 **"文件和打印机共享(回显请求 - ICMPv4-In)"** 的规则。

5. 找到 "配置文件" (Profile) 是 **"私有" (Private)** 或 **"公用" (Public)** 的那一个 (这取决于你的以太网被识别为什么类型)。

6. 右键点击该规则，选择 **"启用规则"**。

	![image-20251027155335147](assets/13.png)

至此，三端网络配置完毕，通过设置uboot环境变量，可以通过dhcp从网络端启动Linux内核。
